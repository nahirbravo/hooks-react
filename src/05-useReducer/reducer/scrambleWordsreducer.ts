// import { scrambleWordsReducer } from './scrambleWordsreducer';
import { stat } from 'fs';
import { ScrambleWords } from './ScrambleWordsUseState';


export interface ScrambleWordsState{
    currentWord: string;
    errorCounter:number;
    guess:string;
    isGameoOver: boolean;
    maxAllowErrors:number;
    maxSkips: number;
    points: number;
    scrambledWord: string;
    skiprCounter:number;
    words: string[];
    totalWords: number;
}



const GAME_WORDS = [
  'REACT',
  'JAVASCRIPT',
  'TYPESCRIPT',
  'HTML',
  'ANGULAR',
  'SOLID',
  'NODE',
  'VUEJS',
  'SVELTE',
  'EXPRESS',
  'MONGODB',
  'POSTGRES',
  'DOCKER',
  'KUBERNETES',
  'WEBPACK',
  'VITE',
  'TAILWIND',
];

// Esta función mezcla el arreglo para que siempre sea aleatorio
const shuffleArray = (array: string[]) => {
  return array.sort(() => Math.random() - 0.5);
};

// Esta función mezcla las letras de la palabra
const scrambleWord = (word: string = '') => {
  return word
    .split('')
    .sort(() => Math.random() - 0.5)
    .join('');
};

export const getInitialState = (): ScrambleWordsState => {

    const shuffleWords = shuffleArray([...GAME_WORDS])

    return {
            currentWord:shuffleWords[0] ,
            errorCounter:0,
            guess:'',
            isGameoOver:false ,
            maxAllowErrors:3,
            maxSkips: 3,
            points: 0,
            scrambledWord:scrambleWord(shuffleWords[0]) ,
            skiprCounter: 0,
            words:shuffleWords ,
            totalWords: shuffleWords.length
    }
}
export type ScrambleWordsAction = 
| {type: 'SET_GUESS', payload: string}
| {type: 'CHECK_ANSWER'}
| {type: 'SKIP_WORD'}
| {type: 'START_NEW_GAME', payload: ScrambleWordsState}
export const scrambleWordsReducer = (state: ScrambleWordsState, action: ScrambleWordsAction): ScrambleWordsState=> {
    switch(action.type){
        case 'SET_GUESS':
            return{
                ...state,
                guess: action.payload.trim().toUpperCase(),
            }
        case 'CHECK_ANSWER': {
            if(state.currentWord === state.guess){
                const newWords = state.words.slice(1)
                return{
                    ...state,
                    words: newWords,
                    points: state.points + 1,
                    guess: '',
                    currentWord: newWords[0],
                    scrambledWord: scrambleWord(newWords[0])

                }
            }
            return{
                ...state,
                guess: '',
                errorCounter: state.errorCounter +1,
                isGameoOver: state.errorCounter +1 >= state.maxAllowErrors ,
            };
        }

            case 'SKIP_WORD':{
                if(state.skiprCounter >=  state.maxSkips)return state;
                const updatedWords = state.words.slice(1);
                return{
                    ...state,
                    skiprCounter: state.skiprCounter +1,
                    words: updatedWords,
                    currentWord: updatedWords[0],
                    scrambledWord: scrambleWord(updatedWords[0]),
                    guess: ''
                }

            }
            case 'START_NEW_GAME': {
                return action.payload;
            }

       default:
        return state; 
    }
}